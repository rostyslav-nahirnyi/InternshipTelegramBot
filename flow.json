[
    {
        "id": "dbbd86af.74c0d8",
        "type": "tab",
        "label": "Main Flow",
        "disabled": false,
        "info": ""
    },
    {
        "id": "96f6108e.64a37",
        "type": "tab",
        "label": "Start command",
        "disabled": false,
        "info": ""
    },
    {
        "id": "696b129b.360e0c",
        "type": "tab",
        "label": "Is registration completed",
        "disabled": false,
        "info": ""
    },
    {
        "id": "4c6874fb.68b9dc",
        "type": "tab",
        "label": "Editing username",
        "disabled": false,
        "info": ""
    },
    {
        "id": "3b5b98a.1c38768",
        "type": "tab",
        "label": "Editing location",
        "disabled": false,
        "info": ""
    },
    {
        "id": "68a30d94.469f94",
        "type": "tab",
        "label": "Editing occupation",
        "disabled": false,
        "info": ""
    },
    {
        "id": "df5e43cb.b674f",
        "type": "tab",
        "label": "Main menu",
        "disabled": false,
        "info": ""
    },
    {
        "id": "276bc02d.e347",
        "type": "tab",
        "label": "Static info",
        "disabled": false,
        "info": ""
    },
    {
        "id": "d3d080fa.62628",
        "type": "tab",
        "label": "The most popular questions",
        "disabled": false,
        "info": ""
    },
    {
        "id": "cbf72f33.63dd6",
        "type": "tab",
        "label": "Chatting",
        "disabled": false,
        "info": ""
    },
    {
        "id": "411ddac8.164cb4",
        "type": "subflow",
        "name": "Send message to the chat",
        "info": "",
        "category": "",
        "in": [
            {
                "x": 140,
                "y": 80,
                "wires": [
                    {
                        "id": "bd92a1fe.c5f6f"
                    }
                ]
            }
        ],
        "out": [
            {
                "x": 720,
                "y": 80,
                "wires": [
                    {
                        "id": "b8d99eac.ee468",
                        "port": 0
                    }
                ]
            }
        ],
        "env": [],
        "color": "#DDAA99"
    },
    {
        "id": "4001764a.8341f8",
        "type": "subflow",
        "name": "Remove inline keyboard",
        "info": "",
        "category": "",
        "in": [
            {
                "x": 160,
                "y": 80,
                "wires": [
                    {
                        "id": "a46d83e7.59837"
                    }
                ]
            }
        ],
        "out": [
            {
                "x": 1980,
                "y": 80,
                "wires": [
                    {
                        "id": "cfe21d91.ca59b",
                        "port": 0
                    }
                ]
            }
        ],
        "env": [],
        "color": "#DDAA99"
    },
    {
        "id": "529c4263.aeab0c",
        "type": "MySQLdatabase",
        "name": "",
        "host": "localhost",
        "port": "3306",
        "db": "internship_telegram_bot",
        "tz": "",
        "charset": "UTF8"
    },
    {
        "id": "b513f9.a96b5c08",
        "type": "dialogflowv2-token",
        "name": "Questions"
    },
    {
        "id": "95f1f9c.778f308",
        "type": "dialogflowv2-token",
        "name": "dialogflow_node_red"
    },
    {
        "id": "83a6c20c.1b51b",
        "type": "function",
        "z": "4c6874fb.68b9dc",
        "name": "Updating user name",
        "func": "msg.first_name = msg.payload.callback_query.message.chat.first_name ? msg.payload.callback_query.message.chat.first_name : '';\nmsg.last_name = msg.payload.callback_query.message.chat.last_name ? msg.payload.callback_query.message.chat.last_name : '';\n\nmsg.topic = \"UPDATE Users SET username = '\" + msg.first_name + \" \" + msg.last_name + \"' WHERE user_telegram_id = \" + msg.chat_id + \";\";\n\n//for the next question\nmsg.text = \"Ð—Ñ€Ð¾Ð·ÑƒÐ¼Ñ–Ð»Ð¾. Ð”Ðµ Ð²Ð¸ Ð¿Ñ€Ð¾Ð¶Ð¸Ð²Ð°Ñ”Ñ‚Ðµ?\";\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 440,
        "y": 160,
        "wires": [
            [
                "573aa76b.c47f38"
            ]
        ]
    },
    {
        "id": "49db1ec2.c7de4",
        "type": "link in",
        "z": "4c6874fb.68b9dc",
        "name": "Set username to default name",
        "links": [
            "96e4744d.d20358",
            "e97be8fd.b371d8",
            "9fa707eb.be1788"
        ],
        "x": 235,
        "y": 160,
        "wires": [
            [
                "83a6c20c.1b51b",
                "28cc6c0e.6a0174"
            ]
        ]
    },
    {
        "id": "573aa76b.c47f38",
        "type": "mysql",
        "z": "4c6874fb.68b9dc",
        "mydb": "529c4263.aeab0c",
        "name": "",
        "x": 730,
        "y": 160,
        "wires": [
            [
                "f553be12.15931",
                "4d10c364.bba70c"
            ]
        ]
    },
    {
        "id": "f553be12.15931",
        "type": "debug",
        "z": "4c6874fb.68b9dc",
        "name": "Setting username to default response from db",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1080,
        "y": 240,
        "wires": []
    },
    {
        "id": "28cc6c0e.6a0174",
        "type": "debug",
        "z": "4c6874fb.68b9dc",
        "name": "Setting username to default incoming data",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 450,
        "y": 240,
        "wires": []
    },
    {
        "id": "643d38df.03a4c8",
        "type": "function",
        "z": "4c6874fb.68b9dc",
        "name": "Setting up response",
        "func": "msg.payload = {\n    text: \"Ð’ÐºÐ°Ð¶Ñ–Ñ‚ÑŒ, Ð±ÑƒÐ´ÑŒ Ð»Ð°ÑÐºÐ°, ÑÐ²Ð¾Ñ” Ñ–Ð¼'ÑðŸ‘‡\",\n    chat_id: msg.chat_id\n}\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 1820,
        "y": 160,
        "wires": [
            [
                "c538e448.9052c8"
            ]
        ]
    },
    {
        "id": "407592c4.adb5ec",
        "type": "link in",
        "z": "4c6874fb.68b9dc",
        "name": "Send request message to enter a new username",
        "links": [
            "b48e521d.7a459",
            "ba2be4d7.46a368",
            "8b7e5ba1.e6b3d8",
            "7009e878.03e338"
        ],
        "x": 1605,
        "y": 160,
        "wires": [
            [
                "643d38df.03a4c8"
            ]
        ]
    },
    {
        "id": "4d10c364.bba70c",
        "type": "link out",
        "z": "4c6874fb.68b9dc",
        "name": "Move on to setting the location field",
        "links": [
            "b0af6159.780a4",
            "1835ced7.6011d1"
        ],
        "x": 935,
        "y": 160,
        "wires": []
    },
    {
        "id": "37feab15.469a44",
        "type": "comment",
        "z": "4c6874fb.68b9dc",
        "name": "Setting username to default name",
        "info": "",
        "x": 350,
        "y": 120,
        "wires": []
    },
    {
        "id": "56b28ca1.adcfe4",
        "type": "comment",
        "z": "4c6874fb.68b9dc",
        "name": "Request message to enter a new username",
        "info": "",
        "x": 1760,
        "y": 120,
        "wires": []
    },
    {
        "id": "29b87cf7.8de694",
        "type": "debug",
        "z": "4c6874fb.68b9dc",
        "name": "Setting username field to 'editing' response from db",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 3170,
        "y": 220,
        "wires": []
    },
    {
        "id": "66c7218a.a9dc1",
        "type": "mysql",
        "z": "4c6874fb.68b9dc",
        "mydb": "529c4263.aeab0c",
        "name": "",
        "x": 2820,
        "y": 160,
        "wires": [
            [
                "29b87cf7.8de694"
            ]
        ]
    },
    {
        "id": "32bc9488.39455c",
        "type": "function",
        "z": "4c6874fb.68b9dc",
        "name": "Changing username field",
        "func": "msg.topic = \"UPDATE Users SET username = '/editingField3252346' WHERE user_telegram_id = \" + msg.chat_id + \";\";\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 2480,
        "y": 160,
        "wires": [
            [
                "66c7218a.a9dc1"
            ]
        ]
    },
    {
        "id": "981f1664.6f90e8",
        "type": "comment",
        "z": "4c6874fb.68b9dc",
        "name": "Move on to setting the location field",
        "info": "",
        "x": 1060,
        "y": 120,
        "wires": []
    },
    {
        "id": "cab5fa05.8972f8",
        "type": "function",
        "z": "96f6108e.64a37",
        "name": "Setting up response greeting to '/start'",
        "func": "msg.payload = {\n    text: \"ÐŸÑ€Ð¸Ð²Ñ–Ñ‚! Ð¯ Ð±Ð¾Ñ‚ ÐºÐ°Ñ„ÐµÐ´Ñ€Ð¸ Ð†Ð¡Ðœ.ðŸ‘¨â€ðŸ’»Ð— Ñ€Ð°Ð´Ñ–ÑÑ‚ÑŽ Ð´Ð¾Ð¿Ð¾Ð¼Ð¾Ð¶Ñƒ Ð·Ð½Ð°Ð¹Ñ‚Ð¸ Ð²Ñ–Ð´Ð¿Ð¾Ð²Ñ–Ð´ÑŒ Ð½Ð° Ð²ÑÑ– Ð²Ð°ÑˆÑ– Ð¿Ð¸Ñ‚Ð°Ð½Ð½Ñ\",\n    chat_id: msg.chat_id\n}\n\n//for the next question\nmsg.text = \"Ð”Ð°Ð²Ð°Ð¹Ñ‚Ðµ Ð·Ð½Ð°Ð¹Ð¾Ð¼Ð¸Ñ‚Ð¸ÑÑŒ Ð±Ð»Ð¸Ð¶Ñ‡Ðµ. Ð§Ð¸ Ð¼Ð¾Ð¶Ñƒ Ñ Ð´Ð¾ Ð²Ð°Ñ Ð·Ð²ÐµÑ€Ñ‚Ð°Ñ‚Ð¸ÑÑ \" + msg.first_name + \" \" + msg.last_name + \"?\"\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 2510,
        "y": 120,
        "wires": [
            [
                "c965d10e.f8642"
            ]
        ]
    },
    {
        "id": "20d295e5.2aa6ca",
        "type": "function",
        "z": "96f6108e.64a37",
        "name": "Setting up request message to set username",
        "func": "msg.payload = {\n    text: msg.text,\n    reply_markup: {\n        inline_keyboard: [[\n            {\n                text: \"Ð¢Ð°Ðº, Ð·Ð²Ñ–ÑÐ½Ð¾\",\n                callback_data: \"setCurrentName\"\n            }, \n            {\n                text: \"Ð¯ Ñ…Ð¾Ñ‡Ñƒ Ð·Ð¼Ñ–Ð½Ð¸Ñ‚Ð¸\",\n                callback_data: \"setName\"\n            }]\n        ]\n    },\n    chat_id: msg.chat_id,\n}\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 3330,
        "y": 120,
        "wires": [
            [
                "cece57bc.ae7278"
            ]
        ]
    },
    {
        "id": "e897d605.f901d8",
        "type": "mysql",
        "z": "96f6108e.64a37",
        "mydb": "529c4263.aeab0c",
        "name": "",
        "x": 830,
        "y": 220,
        "wires": [
            [
                "41e89314.19813c",
                "776fd5bc.aa182c"
            ]
        ]
    },
    {
        "id": "41e89314.19813c",
        "type": "debug",
        "z": "96f6108e.64a37",
        "name": "Getting username field in 'start command flow' response from db",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1210,
        "y": 300,
        "wires": []
    },
    {
        "id": "776fd5bc.aa182c",
        "type": "function",
        "z": "96f6108e.64a37",
        "name": "Checking presence of user row",
        "func": "if (msg.payload.length) return [null, msg];\nelse return [msg, null];",
        "outputs": 2,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 1170,
        "y": 220,
        "wires": [
            [
                "58ada314.42903c"
            ],
            [
                "65f19cea.cc3ef4"
            ]
        ]
    },
    {
        "id": "de1e2237.23c0a",
        "type": "function",
        "z": "96f6108e.64a37",
        "name": "Getting user row",
        "func": "msg.topic = \"SELECT * FROM Users WHERE user_telegram_id = \" + msg.chat_id + \";\";\n\nreturn [msg, null];",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 600,
        "y": 220,
        "wires": [
            [
                "e897d605.f901d8"
            ]
        ]
    },
    {
        "id": "bb24cad3.d57618",
        "type": "link in",
        "z": "96f6108e.64a37",
        "name": "Start",
        "links": [
            "2cfd1290.cbdfde",
            "b2bc8798.6a3f68",
            "a30c38e0.20a148",
            "712534ba.03dabc"
        ],
        "x": 415,
        "y": 220,
        "wires": [
            [
                "de1e2237.23c0a",
                "954a6c74.4f585"
            ]
        ]
    },
    {
        "id": "fc1f4d6.e69b0b",
        "type": "comment",
        "z": "96f6108e.64a37",
        "name": "Start",
        "info": "",
        "x": 450,
        "y": 180,
        "wires": []
    },
    {
        "id": "1835ced7.6011d1",
        "type": "link in",
        "z": "3b5b98a.1c38768",
        "name": "Send message to set the location field",
        "links": [
            "4d10c364.bba70c",
            "67e90bd9.a1e8c4",
            "ce2794d2.a63448",
            "fc83002f.8146f",
            "6f605b10.5004f4",
            "d8112410.42a728",
            "bba92257.ecedb",
            "82300e9c.ebaef",
            "edc1406.22255c",
            "25ba409f.99d92"
        ],
        "x": 175,
        "y": 140,
        "wires": [
            [
                "d2a126cb.79b0c8"
            ]
        ]
    },
    {
        "id": "d2a126cb.79b0c8",
        "type": "function",
        "z": "3b5b98a.1c38768",
        "name": "Setting up question for location",
        "func": "msg.payload = {\n    text: msg.text,    \n    chat_id: msg.chat_id\n}\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 470,
        "y": 140,
        "wires": [
            [
                "bcaa2825.03ec98"
            ]
        ]
    },
    {
        "id": "f83bba65.663248",
        "type": "function",
        "z": "3b5b98a.1c38768",
        "name": "Changing city field",
        "func": "msg.topic = \"UPDATE Users SET city = '/editingField3252346' WHERE user_telegram_id = \" + msg.chat_id + \";\";\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 1170,
        "y": 140,
        "wires": [
            [
                "35525640.5c6d6a"
            ]
        ]
    },
    {
        "id": "35525640.5c6d6a",
        "type": "mysql",
        "z": "3b5b98a.1c38768",
        "mydb": "529c4263.aeab0c",
        "name": "",
        "x": 1490,
        "y": 140,
        "wires": [
            [
                "c6df9017.a5565"
            ]
        ]
    },
    {
        "id": "c6df9017.a5565",
        "type": "debug",
        "z": "3b5b98a.1c38768",
        "name": "Changing city field to 'editing' response from db",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1820,
        "y": 220,
        "wires": []
    },
    {
        "id": "64fc7f2f.7e856",
        "type": "comment",
        "z": "3b5b98a.1c38768",
        "name": "Request message to enter a location",
        "info": "",
        "x": 300,
        "y": 100,
        "wires": []
    },
    {
        "id": "62bdcfd6.d166e",
        "type": "link in",
        "z": "68a30d94.469f94",
        "name": "Send message to set the occupation field",
        "links": [
            "8a07dd6e.fb122",
            "eb6c15f.d5924e8",
            "cbb721f9.d1df5",
            "99c3c041.c38d3",
            "4984be9d.47765",
            "76dc39c7.1f1908",
            "1b5b2acd.749c85"
        ],
        "x": 195,
        "y": 300,
        "wires": [
            [
                "c54069b2.59d4f8"
            ]
        ]
    },
    {
        "id": "c54069b2.59d4f8",
        "type": "function",
        "z": "68a30d94.469f94",
        "name": "Setting up 'choose occupation' message",
        "func": "msg.payload = {\n    text: msg.text,\n    reply_markup: {\n        inline_keyboard: [[\n            {\n                text: \"ÐÐ±Ñ–Ñ‚ÑƒÑ€Ñ–Ñ”Ð½Ñ‚\",\n                callback_data: \"setOccupationAsAnApplicant\"            \n            }, \n            {\n                text: \"ÐžÐ´Ð¸Ð½ Ð· Ð±Ð°Ñ‚ÑŒÐºÑ–Ð²\",\n                callback_data: \"setOccupationAsOneOfTheParents\"            \n            }],\n            [{\n                text: \"Ð’Ð¸ÐºÐ»Ð°Ð´Ð°Ñ‡\",\n                callback_data: \"setOccupationAsATeacher\"            \n            },\n            {\n                text: \"Ð¡Ñ‚ÑƒÐ´ÐµÐ½Ñ‚\",\n                callback_data: \"setOccupationAsAStudent\"            \n            }],\n            [{\n                text: \"Ð†Ð½ÑˆÐµ\",\n                callback_data: \"setOccupationAsOther\"            \n            }]\n        ]\n    },\n    chat_id: msg.chat_id\n}\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 460,
        "y": 300,
        "wires": [
            [
                "6a938578.b8740c"
            ]
        ]
    },
    {
        "id": "efb68a90.a747e8",
        "type": "function",
        "z": "68a30d94.469f94",
        "name": "Set occupation as an applicant",
        "func": "msg.topic = \"UPDATE Users SET occupation = 'Applicant' WHERE user_telegram_id = \" + msg.chat_id + \";\";\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 1870,
        "y": 180,
        "wires": [
            [
                "8ce9f8ec.862708"
            ]
        ]
    },
    {
        "id": "35734a3f.d60566",
        "type": "function",
        "z": "68a30d94.469f94",
        "name": "Set occupation as one of the parents",
        "func": "msg.topic = \"UPDATE Users SET occupation = 'One of the parents' WHERE user_telegram_id = \" + msg.chat_id + \";\";\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 1890,
        "y": 240,
        "wires": [
            [
                "8ce9f8ec.862708"
            ]
        ]
    },
    {
        "id": "28c9f7e4.efea48",
        "type": "function",
        "z": "68a30d94.469f94",
        "name": "Set occupation as a teacher",
        "func": "msg.topic = \"UPDATE Users SET occupation = 'Teacher' WHERE user_telegram_id = \" + msg.chat_id + \";\";\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 1860,
        "y": 300,
        "wires": [
            [
                "8ce9f8ec.862708"
            ]
        ]
    },
    {
        "id": "564c6898.976ac8",
        "type": "function",
        "z": "68a30d94.469f94",
        "name": "Set occupation as a student",
        "func": "msg.topic = \"UPDATE Users SET occupation = 'Student' WHERE user_telegram_id = \" + msg.chat_id + \";\";\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 1860,
        "y": 360,
        "wires": [
            [
                "8ce9f8ec.862708"
            ]
        ]
    },
    {
        "id": "acac65a4.a6de98",
        "type": "function",
        "z": "68a30d94.469f94",
        "name": "Set occupation as other",
        "func": "msg.topic = \"UPDATE Users SET occupation = 'Other' WHERE user_telegram_id = \" + msg.chat_id + \";\";\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 1850,
        "y": 420,
        "wires": [
            [
                "8ce9f8ec.862708"
            ]
        ]
    },
    {
        "id": "bfff6d3f.b5c17",
        "type": "debug",
        "z": "68a30d94.469f94",
        "name": "Editing occupation field response from db",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 2680,
        "y": 360,
        "wires": []
    },
    {
        "id": "59d394d6.305dac",
        "type": "link out",
        "z": "68a30d94.469f94",
        "name": "Move on to printing main menu",
        "links": [
            "f1be3b15.c41ab8",
            "502c79bf.c60c68"
        ],
        "x": 2615,
        "y": 280,
        "wires": []
    },
    {
        "id": "ed917a17.8e5078",
        "type": "link in",
        "z": "68a30d94.469f94",
        "name": "Set occupation as an applicant",
        "links": [
            "2b168ecb.915b02",
            "8d8d567.b8915a8",
            "9f17155a.a2e3d8"
        ],
        "x": 1415,
        "y": 180,
        "wires": [
            [
                "efb68a90.a747e8"
            ]
        ]
    },
    {
        "id": "4f5ec5f6.e9838c",
        "type": "link in",
        "z": "68a30d94.469f94",
        "name": "Set occupation as one of the parents",
        "links": [
            "84969f23.caa1",
            "a7216124.6534",
            "ab9f10ed.c145a"
        ],
        "x": 1415,
        "y": 240,
        "wires": [
            [
                "35734a3f.d60566"
            ]
        ]
    },
    {
        "id": "f2c3d2a0.25b49",
        "type": "link in",
        "z": "68a30d94.469f94",
        "name": "Set occupation as a teacher",
        "links": [
            "b50620a8.7515",
            "5ffcf5e0.aa2fec",
            "7f128497.b6240c"
        ],
        "x": 1415,
        "y": 300,
        "wires": [
            [
                "28c9f7e4.efea48"
            ]
        ]
    },
    {
        "id": "4ed757e7.456528",
        "type": "link in",
        "z": "68a30d94.469f94",
        "name": "Set occupation as a student",
        "links": [
            "1356b19c.1cb64e",
            "3b6ee588.2aab8a",
            "68c78f79.2c1b2"
        ],
        "x": 1415,
        "y": 360,
        "wires": [
            [
                "564c6898.976ac8"
            ]
        ]
    },
    {
        "id": "bcbdc401.9580e8",
        "type": "link in",
        "z": "68a30d94.469f94",
        "name": "Set occupation as other",
        "links": [
            "ce92fb67.2ac148",
            "9eae2df4.d9717",
            "7501c22.02e853c"
        ],
        "x": 1415,
        "y": 420,
        "wires": [
            [
                "acac65a4.a6de98"
            ]
        ]
    },
    {
        "id": "f1632c06.222ac",
        "type": "comment",
        "z": "68a30d94.469f94",
        "name": "Setting occupation",
        "info": "",
        "x": 1490,
        "y": 140,
        "wires": []
    },
    {
        "id": "ba8647ee.f68c28",
        "type": "comment",
        "z": "68a30d94.469f94",
        "name": "Request message to choose an occupation",
        "info": "",
        "x": 340,
        "y": 260,
        "wires": []
    },
    {
        "id": "ea5c7390.3d1a9",
        "type": "comment",
        "z": "68a30d94.469f94",
        "name": "Move on to printing main menu",
        "info": "",
        "x": 2730,
        "y": 240,
        "wires": []
    },
    {
        "id": "65f1945a.2f170c",
        "type": "function",
        "z": "cbf72f33.63dd6",
        "name": "Getting user row",
        "func": "msg.topic = \"SELECT username, city, occupation FROM Users WHERE user_telegram_id = '\" + msg.chat_id + \"';\";\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 360,
        "y": 600,
        "wires": [
            [
                "99e2c09e.30ba3"
            ]
        ]
    },
    {
        "id": "99e2c09e.30ba3",
        "type": "mysql",
        "z": "cbf72f33.63dd6",
        "mydb": "529c4263.aeab0c",
        "name": "",
        "x": 730,
        "y": 600,
        "wires": [
            [
                "e0bc4239.7e156",
                "feea9eea.8f9fd"
            ]
        ]
    },
    {
        "id": "e0bc4239.7e156",
        "type": "function",
        "z": "cbf72f33.63dd6",
        "name": "Editing username or city or move on to processing message",
        "func": "function setErrorMessage(text) {\n    if (msg.message == \"/editingField3252346\") {\n        msg.payload = {\n            text: text,\n            chat_id: msg.chat_id\n        }\n        \n        return false;\n    }\n    \n    return true;\n}\n\nfunction isTooLongAnswer(text) {\n    if (msg.message.length > 120) {\n        msg.payload = {\n            text: text,\n            chat_id: msg.chat_id\n        }\n        \n        return true;\n    }\n    \n    return false;\n}\n\nif (msg.payload[0]) {\n    if (msg.payload[0].occupation) {\n        \n        //sending saved contexts\n        msg.queryParams = {\n            contexts: global.get(msg.chat_id.toString())\n        };\n        \n        //slice if it is answer to dialogflow question\n        if (msg.message.startsWith(\"answerToDFQuestion_\")) {\n            msg.payload = msg.message.slice(19);\n        } else {\n            msg.payload = msg.message;\n        }\n        \n        return [null, null, null, msg, null];\n    }\n    if (msg.payload[0].username && msg.payload[0].username == \"/editingField3252346\" && setErrorMessage(\"Ð’ÐºÐ°Ð¶Ñ–Ñ‚ÑŒ, Ð±ÑƒÐ´ÑŒ Ð»Ð°ÑÐºÐ°, ÐºÐ¾Ñ€ÐµÐºÑ‚Ð½Ðµ Ñ–Ð¼'Ñ\")) {\n        if (isTooLongAnswer(\"Ð’Ð¸ Ð²Ð²ÐµÐ»Ð¸ Ð·Ð°Ð´ÑƒÐ¶Ðµ Ð´Ð¾Ð²Ð³Ðµ Ñ–Ð¼'Ñ\")) return [null, null, msg, null, null];\n        \n        msg.topic = \"UPDATE Users SET username = '\" + msg.message + \"' WHERE user_telegram_id = \" + msg.chat_id + \";\";\n        \n        //for the next question\n        msg.text = \"Ð—Ñ€Ð¾Ð·ÑƒÐ¼Ñ–Ð»Ð¾. Ð”Ðµ Ð²Ð¸ Ð¿Ñ€Ð¾Ð¶Ð¸Ð²Ð°Ñ”Ñ‚Ðµ?\";\n        \n        return [msg, null, null, null, null];\n    } else if (msg.payload[0].city && msg.payload[0].city == \"/editingField3252346\" && setErrorMessage(\"Ð’ÐºÐ°Ð¶Ñ–Ñ‚ÑŒ, Ð±ÑƒÐ´ÑŒ Ð»Ð°ÑÐºÐ°, ÐºÐ¾Ñ€ÐµÐºÑ‚Ð½Ðµ Ð¼Ñ–ÑÑ‚Ð¾\")) {\n        if (isTooLongAnswer(\"Ð’Ð¸ Ð²Ð²ÐµÐ»Ð¸ Ð·Ð°Ð´ÑƒÐ¶Ðµ Ð´Ð¾Ð²Ð³Ñƒ Ð²Ñ–Ð´Ð¿Ð¾Ð²Ñ–Ð´ÑŒ\")) return [null, null, msg, null, null];\n        \n        msg.topic = \"UPDATE Users SET city = '\" + msg.message + \"' WHERE user_telegram_id = \" + msg.chat_id + \";\";\n        \n        //for the next message\n        msg.text = \"Ð¡ÑƒÐ¿ÐµÑ€. Ð”Ð»Ñ ÐºÑ€Ð°Ñ‰Ð¾Ð³Ð¾ Ð¿Ñ–Ð´Ð±Ð¾Ñ€Ñƒ FAQ ðŸ“Š Ð²Ð¸Ð±ÐµÑ€Ñ–Ñ‚ÑŒ ÑÐ²Ñ–Ð¹ Ð²Ð¸Ð´ Ð·Ð°Ð¹Ð½ÑÑ‚Ð¾ÑÑ‚Ñ–\";\n        \n        return [null, msg, null, null, null];\n    }\n}\n\nreturn [null, null, null, null, msg];",
        "outputs": 5,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 1200,
        "y": 600,
        "wires": [
            [
                "6b11dc25.33b244"
            ],
            [
                "2e3fabf6.d47a14"
            ],
            [
                "5b53c12b.cc56"
            ],
            [
                "c82c545b.287d98"
            ],
            [
                "452a3d2.72b81c4"
            ]
        ],
        "outputLabels": [
            "Saving the username field",
            "Saving the city field",
            "Sending a message",
            "Send answer to one of the most popular questions",
            "DialogFlow Processing Message"
        ]
    },
    {
        "id": "6b11dc25.33b244",
        "type": "mysql",
        "z": "cbf72f33.63dd6",
        "mydb": "529c4263.aeab0c",
        "name": "",
        "x": 1830,
        "y": 180,
        "wires": [
            [
                "bba92257.ecedb"
            ]
        ]
    },
    {
        "id": "feea9eea.8f9fd",
        "type": "debug",
        "z": "cbf72f33.63dd6",
        "name": "Getting username and city fields 'Chatting flow' response from db",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1080,
        "y": 680,
        "wires": []
    },
    {
        "id": "bba92257.ecedb",
        "type": "link out",
        "z": "cbf72f33.63dd6",
        "name": "Move on to setting the location field",
        "links": [
            "b0af6159.780a4",
            "1835ced7.6011d1"
        ],
        "x": 2035,
        "y": 180,
        "wires": []
    },
    {
        "id": "2e3fabf6.d47a14",
        "type": "mysql",
        "z": "cbf72f33.63dd6",
        "mydb": "529c4263.aeab0c",
        "name": "",
        "x": 1830,
        "y": 380,
        "wires": [
            [
                "76dc39c7.1f1908"
            ]
        ]
    },
    {
        "id": "76dc39c7.1f1908",
        "type": "link out",
        "z": "cbf72f33.63dd6",
        "name": "Move on to choosing occupation",
        "links": [
            "4b1be78d.e0a2d8",
            "62bdcfd6.d166e"
        ],
        "x": 2035,
        "y": 380,
        "wires": []
    },
    {
        "id": "5581481b.706b38",
        "type": "link in",
        "z": "cbf72f33.63dd6",
        "name": "Edit username or city or process message",
        "links": [
            "51ec0c6.d7d05f4",
            "8647b9c8.fe2fa8",
            "573ec4ad.79ec3c",
            "cf1785ac.c60b58",
            "17a4ed75.37c813",
            "5079e290.c379dc"
        ],
        "x": 175,
        "y": 600,
        "wires": [
            [
                "65f1945a.2f170c"
            ]
        ]
    },
    {
        "id": "11cb9c66.1c2c64",
        "type": "comment",
        "z": "cbf72f33.63dd6",
        "name": "Processing other messages. Edit username or city",
        "info": "",
        "x": 350,
        "y": 560,
        "wires": []
    },
    {
        "id": "bd92a1fe.c5f6f",
        "type": "change",
        "z": "411ddac8.164cb4",
        "name": "Setting up bot url",
        "rules": [
            {
                "t": "set",
                "p": "url",
                "pt": "msg",
                "to": "\"https://api.telegram.org/bot\" & $env('TOKEN') & \"/sendMessage\"",
                "tot": "jsonata"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 330,
        "y": 80,
        "wires": [
            [
                "b8d99eac.ee468"
            ]
        ]
    },
    {
        "id": "b8d99eac.ee468",
        "type": "http request",
        "z": "411ddac8.164cb4",
        "name": "",
        "method": "POST",
        "ret": "obj",
        "paytoqs": "ignore",
        "url": "",
        "tls": "",
        "persist": false,
        "proxy": "",
        "authType": "basic",
        "x": 550,
        "y": 80,
        "wires": [
            []
        ]
    },
    {
        "id": "5d8decb2.3014e4",
        "type": "debug",
        "z": "cbf72f33.63dd6",
        "name": "Response from dialogflow",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 2030,
        "y": 860,
        "wires": []
    },
    {
        "id": "c82c545b.287d98",
        "type": "dialogflowv2",
        "z": "cbf72f33.63dd6",
        "dialogflow": "b513f9.a96b5c08",
        "language": "uk",
        "debug": false,
        "queryParamsOK": true,
        "x": 1800,
        "y": 780,
        "wires": [
            [
                "5d8decb2.3014e4",
                "8c22d5f5.4223e8"
            ]
        ]
    },
    {
        "id": "2c767f74.82a47",
        "type": "comment",
        "z": "cbf72f33.63dd6",
        "name": "DialogFlow Processing Message",
        "info": "",
        "x": 1850,
        "y": 740,
        "wires": []
    },
    {
        "id": "63a1490b.736ab8",
        "type": "function",
        "z": "cbf72f33.63dd6",
        "name": "Setting up dialogflow response",
        "func": "msg.payload = {\n    chat_id: msg.chat_id\n}\n\ntry {\n    var jsonResponse = JSON.parse(msg._dialogflow.fulfillmentText.toString());\n    \n    msg.payload.text = jsonResponse.question;\n    \n    var answersArr = [];\n    jsonResponse.answers.forEach((item, i, arr) => {\n       answersArr.push({text: item.text, callback_data: \"answerToDFQuestion_\" + item.callback_data});\n    });\n    \n    \n    msg.payload.reply_markup = {inline_keyboard: [answersArr]};\n    \n}catch (err) {\n    msg.payload.text = msg._dialogflow.fulfillmentText;\n}\n\n\n\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 2590,
        "y": 780,
        "wires": [
            [
                "5a2ebc6a.567e54"
            ]
        ]
    },
    {
        "id": "985d37c2.3d2328",
        "type": "comment",
        "z": "cbf72f33.63dd6",
        "name": "Move on to setting the location field",
        "info": "",
        "x": 2160,
        "y": 140,
        "wires": []
    },
    {
        "id": "74b4671f.1c13a8",
        "type": "comment",
        "z": "cbf72f33.63dd6",
        "name": "Move on to choosing occupation",
        "info": "",
        "x": 2150,
        "y": 340,
        "wires": []
    },
    {
        "id": "452a3d2.72b81c4",
        "type": "link out",
        "z": "cbf72f33.63dd6",
        "name": "Is registration completed",
        "links": [
            "6ff45d49.c66084",
            "4d1e8f79.27d3c"
        ],
        "x": 1735,
        "y": 980,
        "wires": []
    },
    {
        "id": "1795e6cf.ce9ef9",
        "type": "comment",
        "z": "cbf72f33.63dd6",
        "name": "Checking whether the registration is completed",
        "info": "",
        "x": 1900,
        "y": 940,
        "wires": []
    },
    {
        "id": "8c22d5f5.4223e8",
        "type": "function",
        "z": "cbf72f33.63dd6",
        "name": "Saving dialogflow context",
        "func": "global.set(msg.chat_id.toString(), msg._dialogflow.outputContexts);\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 2190,
        "y": 780,
        "wires": [
            [
                "63a1490b.736ab8"
            ]
        ]
    },
    {
        "id": "319d5b6f.be2d74",
        "type": "function",
        "z": "4001764a.8341f8",
        "name": "Removing inline keyboard",
        "func": "//remove inline keyboard\nmsg.payload = {\n    chat_id: msg.chat_id,\n    message_id: msg.message_id,\n    reply_markup: {\n        inline_keyboard: []\n    }\n}\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 730,
        "y": 80,
        "wires": [
            [
                "ac12e929.bfded8"
            ]
        ]
    },
    {
        "id": "4a6d9a4d.b3d5b4",
        "type": "comment",
        "z": "cbf72f33.63dd6",
        "name": "Sending a message",
        "info": "",
        "x": 1810,
        "y": 560,
        "wires": []
    },
    {
        "id": "a64a08f7.365978",
        "type": "comment",
        "z": "cbf72f33.63dd6",
        "name": "Saving the city field",
        "info": "",
        "x": 1810,
        "y": 340,
        "wires": []
    },
    {
        "id": "b908221a.202f7",
        "type": "comment",
        "z": "cbf72f33.63dd6",
        "name": "Saving the username field",
        "info": "",
        "x": 1830,
        "y": 140,
        "wires": []
    },
    {
        "id": "954a6c74.4f585",
        "type": "debug",
        "z": "96f6108e.64a37",
        "name": "Start command incoming data",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 610,
        "y": 300,
        "wires": []
    },
    {
        "id": "8ce9f8ec.862708",
        "type": "mysql",
        "z": "68a30d94.469f94",
        "mydb": "529c4263.aeab0c",
        "name": "",
        "x": 2370,
        "y": 280,
        "wires": [
            [
                "bfff6d3f.b5c17",
                "59d394d6.305dac"
            ]
        ]
    },
    {
        "id": "5b53c12b.cc56",
        "type": "subflow:411ddac8.164cb4",
        "z": "cbf72f33.63dd6",
        "name": "",
        "env": [],
        "x": 1830,
        "y": 600,
        "wires": [
            []
        ]
    },
    {
        "id": "5a2ebc6a.567e54",
        "type": "subflow:411ddac8.164cb4",
        "z": "cbf72f33.63dd6",
        "name": "",
        "env": [],
        "x": 2930,
        "y": 780,
        "wires": [
            [
                "bd895bb.3ba4ea8"
            ]
        ]
    },
    {
        "id": "6a938578.b8740c",
        "type": "subflow:411ddac8.164cb4",
        "z": "68a30d94.469f94",
        "name": "",
        "env": [],
        "x": 820,
        "y": 300,
        "wires": [
            []
        ]
    },
    {
        "id": "bcaa2825.03ec98",
        "type": "subflow:411ddac8.164cb4",
        "z": "3b5b98a.1c38768",
        "name": "",
        "env": [],
        "x": 850,
        "y": 140,
        "wires": [
            [
                "f83bba65.663248"
            ]
        ]
    },
    {
        "id": "c538e448.9052c8",
        "type": "subflow:411ddac8.164cb4",
        "z": "4c6874fb.68b9dc",
        "name": "",
        "env": [],
        "x": 2130,
        "y": 160,
        "wires": [
            [
                "32bc9488.39455c"
            ]
        ]
    },
    {
        "id": "c965d10e.f8642",
        "type": "subflow:411ddac8.164cb4",
        "z": "96f6108e.64a37",
        "name": "",
        "env": [],
        "x": 2850,
        "y": 120,
        "wires": [
            [
                "20d295e5.2aa6ca"
            ]
        ]
    },
    {
        "id": "cece57bc.ae7278",
        "type": "subflow:411ddac8.164cb4",
        "z": "96f6108e.64a37",
        "name": "",
        "env": [],
        "x": 3690,
        "y": 120,
        "wires": [
            []
        ]
    },
    {
        "id": "a46d83e7.59837",
        "type": "change",
        "z": "4001764a.8341f8",
        "name": "Saving msg.payload",
        "rules": [
            {
                "t": "set",
                "p": "payload_copy",
                "pt": "msg",
                "to": "payload",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 360,
        "y": 80,
        "wires": [
            [
                "319d5b6f.be2d74"
            ]
        ]
    },
    {
        "id": "cfe21d91.ca59b",
        "type": "change",
        "z": "4001764a.8341f8",
        "name": "Setting saved payload to msg.payload",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "payload_copy",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1730,
        "y": 80,
        "wires": [
            []
        ]
    },
    {
        "id": "ac12e929.bfded8",
        "type": "change",
        "z": "4001764a.8341f8",
        "name": "Setting up editMessageReplyMarkup url",
        "rules": [
            {
                "t": "set",
                "p": "url",
                "pt": "msg",
                "to": "\"https://api.telegram.org/bot\" & $env('TOKEN') & \"/editMessageReplyMarkup\"",
                "tot": "jsonata"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1060,
        "y": 80,
        "wires": [
            [
                "a41f75cf.a711d8"
            ]
        ]
    },
    {
        "id": "a41f75cf.a711d8",
        "type": "http request",
        "z": "4001764a.8341f8",
        "name": "",
        "method": "POST",
        "ret": "obj",
        "paytoqs": "ignore",
        "url": "",
        "tls": "",
        "persist": false,
        "proxy": "",
        "authType": "basic",
        "x": 1350,
        "y": 80,
        "wires": [
            [
                "cfe21d91.ca59b"
            ]
        ]
    },
    {
        "id": "bd895bb.3ba4ea8",
        "type": "function",
        "z": "cbf72f33.63dd6",
        "name": "Getting info from Questions",
        "func": "msg.topic = \"SELECT * FROM questions WHERE intent = '\" + msg._dialogflow.intent.displayName.split(\" \").join(\"\") + \"';\";\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 3400,
        "y": 780,
        "wires": [
            [
                "348f6b3c.e36434"
            ]
        ]
    },
    {
        "id": "348f6b3c.e36434",
        "type": "mysql",
        "z": "cbf72f33.63dd6",
        "mydb": "529c4263.aeab0c",
        "name": "",
        "x": 3730,
        "y": 780,
        "wires": [
            [
                "a8d398a0.9fa888"
            ]
        ]
    },
    {
        "id": "a8d398a0.9fa888",
        "type": "function",
        "z": "cbf72f33.63dd6",
        "name": "Updating calls field of question",
        "func": "if (msg.payload.length) {\n    msg.topic = \"UPDATE questions SET calls = \" + (msg.payload[0].calls + 1) + \" WHERE intent = '\" + msg._dialogflow.intent.displayName.split(\" \").join(\"\") + \"';\"\n}\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 4230,
        "y": 780,
        "wires": [
            [
                "1ac5f422.4e36ac"
            ]
        ]
    },
    {
        "id": "1ac5f422.4e36ac",
        "type": "mysql",
        "z": "cbf72f33.63dd6",
        "mydb": "529c4263.aeab0c",
        "name": "",
        "x": 4570,
        "y": 780,
        "wires": [
            []
        ]
    },
    {
        "id": "1c133d73.d7c5c3",
        "type": "debug",
        "z": "dbbd86af.74c0d8",
        "name": "Incoming data",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 460,
        "y": 620,
        "wires": []
    },
    {
        "id": "13e44bbe.022ec4",
        "type": "http response",
        "z": "dbbd86af.74c0d8",
        "name": "",
        "statusCode": "200",
        "headers": {},
        "x": 440,
        "y": 680,
        "wires": []
    },
    {
        "id": "be1ed164.1521d",
        "type": "function",
        "z": "dbbd86af.74c0d8",
        "name": "Formatting data",
        "func": "if (msg.payload.callback_query) {\n    msg.message = msg.payload.callback_query.data;\n        \n    msg.chat_id = msg.payload.callback_query.from.id\n    \n    msg.message_id = msg.payload.callback_query.message.message_id;\n    \n    return [msg, null];\n} else if (msg.payload.message) {\n    //saving firstname and lastname of user\n    msg.first_name = msg.payload.message.chat.first_name ? msg.payload.message.chat.first_name : '';\n    msg.last_name = msg.payload.message.chat.last_name ? msg.payload.message.chat.last_name : '';\n\n    msg.message = msg.payload.message.text;\n    \n    msg.chat_id = msg.payload.message.from.id\n    \n    msg.message_id = msg.payload.message.message_id - 1;\n    \n    return [null, msg];\n}\n\nreturn [null, null]",
        "outputs": 2,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 580,
        "y": 540,
        "wires": [
            [
                "c017e434.7d5098"
            ],
            [
                "336efa19.615be6"
            ]
        ]
    },
    {
        "id": "d4173cf4.07cab",
        "type": "switch",
        "z": "dbbd86af.74c0d8",
        "name": "Callback query intents",
        "property": "message",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "setCurrentName",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "setName",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "setCity",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "setOccupationAsAnApplicant",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "setOccupationAsOneOfTheParents",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "setOccupationAsATeacher",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "setOccupationAsAStudent",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "setOccupationAsOther",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "mainMenu",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "theMostPopularQuestions",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "aboutISMDepartment",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "aboutNULP",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "usingBot",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 13,
        "x": 1280,
        "y": 500,
        "wires": [
            [
                "9fa707eb.be1788"
            ],
            [
                "7009e878.03e338"
            ],
            [
                "edc1406.22255c"
            ],
            [
                "9f17155a.a2e3d8"
            ],
            [
                "ab9f10ed.c145a"
            ],
            [
                "7f128497.b6240c"
            ],
            [
                "68c78f79.2c1b2"
            ],
            [
                "7501c22.02e853c"
            ],
            [
                "423e195b.dec3f8"
            ],
            [
                "d7b8d232.f7981"
            ],
            [
                "84602d83.794bf"
            ],
            [
                "84602d83.794bf"
            ],
            [
                "84602d83.794bf"
            ]
        ]
    },
    {
        "id": "9fa707eb.be1788",
        "type": "link out",
        "z": "dbbd86af.74c0d8",
        "name": "Set username to default name",
        "links": [
            "49db1ec2.c7de4"
        ],
        "x": 1775,
        "y": 100,
        "wires": []
    },
    {
        "id": "7009e878.03e338",
        "type": "link out",
        "z": "dbbd86af.74c0d8",
        "name": "Set username",
        "links": [
            "407592c4.adb5ec"
        ],
        "x": 1775,
        "y": 140,
        "wires": []
    },
    {
        "id": "423e195b.dec3f8",
        "type": "link out",
        "z": "dbbd86af.74c0d8",
        "name": "Print main menu",
        "links": [
            "f1be3b15.c41ab8",
            "502c79bf.c60c68"
        ],
        "x": 1775,
        "y": 600,
        "wires": []
    },
    {
        "id": "9f17155a.a2e3d8",
        "type": "link out",
        "z": "dbbd86af.74c0d8",
        "name": "Set occupation as an applicant",
        "links": [
            "3272d461.c8fe5c",
            "ed917a17.8e5078"
        ],
        "x": 1775,
        "y": 340,
        "wires": []
    },
    {
        "id": "ab9f10ed.c145a",
        "type": "link out",
        "z": "dbbd86af.74c0d8",
        "name": "Set occupation as one of the parents",
        "links": [
            "84f1ccf3.e8c91",
            "4f5ec5f6.e9838c"
        ],
        "x": 1775,
        "y": 380,
        "wires": []
    },
    {
        "id": "7f128497.b6240c",
        "type": "link out",
        "z": "dbbd86af.74c0d8",
        "name": "Set occupation as a teacher",
        "links": [
            "7ed591d4.8c433",
            "f2c3d2a0.25b49"
        ],
        "x": 1775,
        "y": 420,
        "wires": []
    },
    {
        "id": "68c78f79.2c1b2",
        "type": "link out",
        "z": "dbbd86af.74c0d8",
        "name": "Set occupation as a student",
        "links": [
            "6ef222d3.893f0c",
            "4ed757e7.456528"
        ],
        "x": 1775,
        "y": 460,
        "wires": []
    },
    {
        "id": "7501c22.02e853c",
        "type": "link out",
        "z": "dbbd86af.74c0d8",
        "name": "Set occupation as other",
        "links": [
            "bebaf9fd.57b3d8",
            "bcbdc401.9580e8"
        ],
        "x": 1775,
        "y": 500,
        "wires": []
    },
    {
        "id": "25afae95.4a6452",
        "type": "comment",
        "z": "dbbd86af.74c0d8",
        "name": "Set occupation",
        "info": "# Setting occupation",
        "x": 1840,
        "y": 300,
        "wires": []
    },
    {
        "id": "4ea530d9.6681",
        "type": "comment",
        "z": "dbbd86af.74c0d8",
        "name": "Main menu",
        "info": "",
        "x": 1820,
        "y": 560,
        "wires": []
    },
    {
        "id": "42e1a254.93316c",
        "type": "comment",
        "z": "dbbd86af.74c0d8",
        "name": "Edit name",
        "info": "",
        "x": 1820,
        "y": 60,
        "wires": []
    },
    {
        "id": "edc1406.22255c",
        "type": "link out",
        "z": "dbbd86af.74c0d8",
        "name": "Set city",
        "links": [
            "b0af6159.780a4",
            "1835ced7.6011d1"
        ],
        "x": 1775,
        "y": 240,
        "wires": []
    },
    {
        "id": "c0030918.bd2f98",
        "type": "comment",
        "z": "dbbd86af.74c0d8",
        "name": "Set city",
        "info": "",
        "x": 1810,
        "y": 200,
        "wires": []
    },
    {
        "id": "d7b8d232.f7981",
        "type": "link out",
        "z": "dbbd86af.74c0d8",
        "name": "Send the most popular questions",
        "links": [
            "e62923c4.ab898",
            "819d9f36.a05c9",
            "db785c0e.a93d6"
        ],
        "x": 1775,
        "y": 700,
        "wires": []
    },
    {
        "id": "92a60b0a.a91188",
        "type": "comment",
        "z": "dbbd86af.74c0d8",
        "name": "Send the most popular questions",
        "info": "",
        "x": 1890,
        "y": 660,
        "wires": []
    },
    {
        "id": "84602d83.794bf",
        "type": "link out",
        "z": "dbbd86af.74c0d8",
        "name": "Send message about ISM department",
        "links": [
            "b25d1f4e.85ebd",
            "94e14c4f.1155d",
            "255971.a036369"
        ],
        "x": 1775,
        "y": 800,
        "wires": []
    },
    {
        "id": "9e3a5712.5abb58",
        "type": "comment",
        "z": "dbbd86af.74c0d8",
        "name": "Send messages about ISM department, NULP, how to use the bot ",
        "info": "",
        "x": 1990,
        "y": 760,
        "wires": []
    },
    {
        "id": "59c1267b.ca3c98",
        "type": "switch",
        "z": "dbbd86af.74c0d8",
        "name": "Answer to dialogflow question",
        "property": "$split(msg.message, \"_\", 1)",
        "propertyType": "jsonata",
        "rules": [
            {
                "t": "eq",
                "v": "answerToDFQuestion",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 1310,
        "y": 1060,
        "wires": [
            [
                "17a4ed75.37c813"
            ]
        ]
    },
    {
        "id": "17a4ed75.37c813",
        "type": "link out",
        "z": "dbbd86af.74c0d8",
        "name": "Process message",
        "links": [
            "957981a1.8fdad",
            "62416c5b.bd8764",
            "5581481b.706b38"
        ],
        "x": 1775,
        "y": 1060,
        "wires": []
    },
    {
        "id": "a1439bf8.dd9a78",
        "type": "comment",
        "z": "dbbd86af.74c0d8",
        "name": "Process message",
        "info": "",
        "x": 1850,
        "y": 1020,
        "wires": []
    },
    {
        "id": "db142eec.63a9b",
        "type": "switch",
        "z": "dbbd86af.74c0d8",
        "name": "Set answer to popular question(pagination)",
        "property": "$split(msg.message, \"_\", 1)",
        "propertyType": "jsonata",
        "rules": [
            {
                "t": "eq",
                "v": "theMostPopularQPagination",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 1350,
        "y": 920,
        "wires": [
            [
                "44ca7e7d.f7226"
            ]
        ]
    },
    {
        "id": "44ca7e7d.f7226",
        "type": "link out",
        "z": "dbbd86af.74c0d8",
        "name": "Set answer to popular question(pagination)",
        "links": [
            "db785c0e.a93d6"
        ],
        "x": 1775,
        "y": 920,
        "wires": []
    },
    {
        "id": "695523ed.ad23dc",
        "type": "comment",
        "z": "dbbd86af.74c0d8",
        "name": "Set answer to popular question(pagination)",
        "info": "",
        "x": 1920,
        "y": 880,
        "wires": []
    },
    {
        "id": "712534ba.03dabc",
        "type": "link out",
        "z": "dbbd86af.74c0d8",
        "name": "/start",
        "links": [
            "20e0ef34.86f5",
            "bb24cad3.d57618"
        ],
        "x": 1775,
        "y": 1240,
        "wires": []
    },
    {
        "id": "5079e290.c379dc",
        "type": "link out",
        "z": "dbbd86af.74c0d8",
        "name": "Process message",
        "links": [
            "957981a1.8fdad",
            "62416c5b.bd8764",
            "5581481b.706b38"
        ],
        "x": 1775,
        "y": 1340,
        "wires": []
    },
    {
        "id": "2cd9581b.de63b8",
        "type": "comment",
        "z": "dbbd86af.74c0d8",
        "name": "Other messages",
        "info": "",
        "x": 1840,
        "y": 1300,
        "wires": []
    },
    {
        "id": "2caa3ca0.e8c6a4",
        "type": "comment",
        "z": "dbbd86af.74c0d8",
        "name": "Start",
        "info": "",
        "x": 1810,
        "y": 1200,
        "wires": []
    },
    {
        "id": "c255e784.8ab028",
        "type": "switch",
        "z": "dbbd86af.74c0d8",
        "name": "Start or message",
        "property": "message",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "/start",
                "vt": "str"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 1270,
        "y": 1280,
        "wires": [
            [
                "712534ba.03dabc"
            ],
            [
                "5079e290.c379dc"
            ]
        ]
    },
    {
        "id": "7e88b121.6fb1e",
        "type": "http in",
        "z": "dbbd86af.74c0d8",
        "name": "",
        "url": "/bot",
        "method": "post",
        "upload": false,
        "swaggerDoc": "",
        "x": 220,
        "y": 540,
        "wires": [
            [
                "1c133d73.d7c5c3",
                "13e44bbe.022ec4",
                "be1ed164.1521d"
            ]
        ]
    },
    {
        "id": "58ada314.42903c",
        "type": "function",
        "z": "96f6108e.64a37",
        "name": "Registering new user row in db",
        "func": "msg.topic = \"INSERT INTO Users (user_telegram_id) VALUES (\" + msg.chat_id + \");\";\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 1690,
        "y": 120,
        "wires": [
            [
                "c7778514.99f498"
            ]
        ]
    },
    {
        "id": "c7778514.99f498",
        "type": "mysql",
        "z": "96f6108e.64a37",
        "mydb": "529c4263.aeab0c",
        "name": "",
        "x": 2050,
        "y": 120,
        "wires": [
            [
                "3038c760.952438",
                "cab5fa05.8972f8"
            ]
        ]
    },
    {
        "id": "3038c760.952438",
        "type": "debug",
        "z": "96f6108e.64a37",
        "name": "Registering new user response from db",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 2360,
        "y": 200,
        "wires": []
    },
    {
        "id": "502c79bf.c60c68",
        "type": "link in",
        "z": "df5e43cb.b674f",
        "name": "Print main menu",
        "links": [
            "9d38cfeb.72544",
            "cfe6162e.b07178",
            "fee03af4.838098",
            "76361c43.ee74f4",
            "59d394d6.305dac",
            "3dff8462.4ec1dc",
            "423e195b.dec3f8",
            "beaeab00.e10d98"
        ],
        "x": 195,
        "y": 160,
        "wires": [
            [
                "e26cee31.fdd81"
            ]
        ]
    },
    {
        "id": "e26cee31.fdd81",
        "type": "function",
        "z": "df5e43cb.b674f",
        "name": "Setting up message with main menu",
        "func": "msg.payload = {\n    text: \"âœ… Ð’Ð¸ Ð² Ð³Ð¾Ð»Ð¾Ð²Ð½Ð¾Ð¼Ñƒ Ð¼ÐµÐ½ÑŽ. Ð’Ð¸Ð±ÐµÑ€Ñ–Ñ‚ÑŒ Ð½ÐµÐ¾Ð±Ñ…Ñ–Ð´Ð½Ð¸Ð¹ Ð¿ÑƒÐ½ÐºÑ‚\",\n    reply_markup: {\n        inline_keyboard: [[\n            {\n                text: \"ÐÐ°Ð¹Ð¿Ð¾Ð¿ÑƒÐ»ÑÑ€Ð½Ñ–ÑˆÑ– Ð¿Ð¸Ñ‚Ð°Ð½Ð½Ñ ðŸ”¥\",\n                callback_data: \"theMostPopularQuestions\"            \n            }], \n            [{\n                text: \"ÐŸÑ€Ð¾ ÐºÐ°Ñ„ÐµÐ´Ñ€Ñƒ ICM ðŸ˜Ž\",\n                callback_data: \"aboutISMDepartment\"            \n            },\n            {\n                text: \"ÐŸÑ€Ð¾ ÐÐ£Ð›ÐŸ ðŸš€\",\n                callback_data: \"aboutNULP\"            \n            }],\n            [{\n                text: \"Ð¯Ðº ÐºÐ¾Ñ€Ð¸ÑÑ‚ÑƒÐ²Ð°Ñ‚Ð¸ÑÑ Ð±Ð¾Ñ‚Ð¾Ð¼ ðŸ“\",\n                callback_data: \"usingBot\"            \n            }]\n        ]\n    },\n    chat_id: msg.chat_id\n}\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 450,
        "y": 160,
        "wires": [
            [
                "744eb46c.1a166c"
            ]
        ]
    },
    {
        "id": "a3e54823.a72818",
        "type": "comment",
        "z": "df5e43cb.b674f",
        "name": "Message with main menu",
        "info": "",
        "x": 290,
        "y": 120,
        "wires": []
    },
    {
        "id": "744eb46c.1a166c",
        "type": "subflow:411ddac8.164cb4",
        "z": "df5e43cb.b674f",
        "name": "",
        "env": [],
        "x": 850,
        "y": 160,
        "wires": [
            []
        ]
    },
    {
        "id": "58a6af09.78559",
        "type": "function",
        "z": "696b129b.360e0c",
        "name": "Is registration completed",
        "func": "if (!msg.payload[0].username || msg.payload[0].username == \"/editingField3252346\") {\n    //for the next question\n    msg.text = \"Ð§Ð¸ Ð¼Ð¾Ð¶Ñƒ Ñ Ð´Ð¾ Ð²Ð°Ñ Ð·Ð²ÐµÑ€Ñ‚Ð°Ñ‚Ð¸ÑÑ \" + msg.first_name + \" \" + msg.last_name + \"?\";\n    \n    return [msg, null, null, null];\n} else if (!msg.payload[0].city || msg.payload[0].city == \"/editingField3252346\") {\n    //for the next question\n    msg.text = \"Ð”Ðµ Ð²Ð¸ Ð¿Ñ€Ð¾Ð¶Ð¸Ð²Ð°Ñ”Ñ‚Ðµ?\";\n    \n    return [null, msg, null, null];\n} else if (!msg.payload[0].occupation) {\n    //for the next question\n    msg.text = \"Ð”Ð»Ñ ÐºÑ€Ð°Ñ‰Ð¾Ð³Ð¾ Ð¿Ñ–Ð´Ð±Ð¾Ñ€Ñƒ FAQ ðŸ“Š Ð²Ð¸Ð±ÐµÑ€Ñ–Ñ‚ÑŒ ÑÐ²Ñ–Ð¹ Ð²Ð¸Ð´ Ð·Ð°Ð¹Ð½ÑÑ‚Ð¾ÑÑ‚Ñ–\";\n    \n    return [null, null, msg, null];\n}\n\nreturn [null, null, null, msg];",
        "outputs": 4,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 890,
        "y": 320,
        "wires": [
            [
                "a9a342.474eccc"
            ],
            [
                "25ba409f.99d92"
            ],
            [
                "1b5b2acd.749c85"
            ],
            [
                "beaeab00.e10d98"
            ]
        ],
        "inputLabels": [
            "Checking whether the registration is completed"
        ],
        "outputLabels": [
            "Move on to setting the username field again",
            "Move on to setting the location field again",
            "Move on to setting the occupation field again",
            "Send main menu message"
        ]
    },
    {
        "id": "25ba409f.99d92",
        "type": "link out",
        "z": "696b129b.360e0c",
        "name": "Move on to setting the location field again",
        "links": [
            "1835ced7.6011d1"
        ],
        "x": 1195,
        "y": 260,
        "wires": []
    },
    {
        "id": "1b5b2acd.749c85",
        "type": "link out",
        "z": "696b129b.360e0c",
        "name": "Move on to setting the occupation field again",
        "links": [
            "62bdcfd6.d166e"
        ],
        "x": 1195,
        "y": 380,
        "wires": []
    },
    {
        "id": "beaeab00.e10d98",
        "type": "link out",
        "z": "696b129b.360e0c",
        "name": "Send main menu message",
        "links": [
            "f1be3b15.c41ab8",
            "502c79bf.c60c68"
        ],
        "x": 1195,
        "y": 500,
        "wires": []
    },
    {
        "id": "4f8a25d5.b0636c",
        "type": "comment",
        "z": "696b129b.360e0c",
        "name": "Send main menu message",
        "info": "",
        "x": 1290,
        "y": 460,
        "wires": []
    },
    {
        "id": "4d1e8f79.27d3c",
        "type": "link in",
        "z": "696b129b.360e0c",
        "name": "Is registration completed",
        "links": [
            "452a3d2.72b81c4",
            "65f19cea.cc3ef4"
        ],
        "x": 355,
        "y": 320,
        "wires": [
            [
                "58a6af09.78559"
            ]
        ]
    },
    {
        "id": "4ce7c89d.99df08",
        "type": "comment",
        "z": "696b129b.360e0c",
        "name": "Move on to setting the location field again",
        "info": "",
        "x": 1340,
        "y": 220,
        "wires": []
    },
    {
        "id": "4ec2269f.2800f8",
        "type": "comment",
        "z": "696b129b.360e0c",
        "name": "Move on to setting the occupation field again",
        "info": "",
        "x": 1350,
        "y": 340,
        "wires": []
    },
    {
        "id": "eec829d9.ecc588",
        "type": "comment",
        "z": "696b129b.360e0c",
        "name": "Checking whether the registration is completed",
        "info": "",
        "x": 520,
        "y": 280,
        "wires": []
    },
    {
        "id": "a9a342.474eccc",
        "type": "function",
        "z": "696b129b.360e0c",
        "name": "Changing username field to null",
        "func": "msg.topic = \"UPDATE Users SET username = NULL WHERE user_telegram_id = \" + msg.chat_id + \";\";\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 1310,
        "y": 140,
        "wires": [
            [
                "76751930.b35418"
            ]
        ]
    },
    {
        "id": "76751930.b35418",
        "type": "mysql",
        "z": "696b129b.360e0c",
        "mydb": "529c4263.aeab0c",
        "name": "",
        "x": 1630,
        "y": 140,
        "wires": [
            [
                "e074a2a5.84fdc"
            ]
        ]
    },
    {
        "id": "62f23a28.fa8414",
        "type": "comment",
        "z": "696b129b.360e0c",
        "name": "Move on to setting the username field again",
        "info": "",
        "x": 1350,
        "y": 100,
        "wires": []
    },
    {
        "id": "65f19cea.cc3ef4",
        "type": "link out",
        "z": "96f6108e.64a37",
        "name": "Is registration completed",
        "links": [
            "4d1e8f79.27d3c"
        ],
        "x": 1575,
        "y": 300,
        "wires": []
    },
    {
        "id": "7c78aa7a.0ce5a4",
        "type": "comment",
        "z": "96f6108e.64a37",
        "name": "Check whether the registration is completed",
        "info": "",
        "x": 1730,
        "y": 260,
        "wires": []
    },
    {
        "id": "a009902e.25a1b",
        "type": "subflow:411ddac8.164cb4",
        "z": "696b129b.360e0c",
        "name": "",
        "env": [],
        "x": 2450,
        "y": 140,
        "wires": [
            []
        ]
    },
    {
        "id": "e074a2a5.84fdc",
        "type": "function",
        "z": "696b129b.360e0c",
        "name": "Setting up request message to set username",
        "func": "msg.payload = {\n    text: msg.text,\n    reply_markup: {\n        inline_keyboard: [[\n            {\n                text: \"Ð¢Ð°Ðº, Ð·Ð²Ñ–ÑÐ½Ð¾\",\n                callback_data: \"setCurrentName\"\n            }, \n            {\n                text: \"Ð¯ Ñ…Ð¾Ñ‡Ñƒ Ð·Ð¼Ñ–Ð½Ð¸Ñ‚Ð¸\",\n                callback_data: \"setName\"\n            }]\n        ]\n    },\n    chat_id: msg.chat_id,\n}\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 2070,
        "y": 140,
        "wires": [
            [
                "a009902e.25a1b"
            ]
        ]
    },
    {
        "id": "27d280f8.1ec68",
        "type": "mysql",
        "z": "d3d080fa.62628",
        "mydb": "529c4263.aeab0c",
        "name": "",
        "x": 730,
        "y": 180,
        "wires": [
            [
                "5c5914e5.d60a4c"
            ]
        ]
    },
    {
        "id": "5c5914e5.d60a4c",
        "type": "function",
        "z": "d3d080fa.62628",
        "name": "Setting up next or last question",
        "func": " msg.payload = {\n    text: msg.message + \". \" + msg.payload[(msg.message - 1)].question + \"\\n\\nÐ’Ñ–Ð´Ð¿Ð¾Ð²Ñ–Ð´ÑŒ:\\n\" + msg.payload[(msg.message - 1)].answer,\n    chat_id: msg.chat_id,\n    message_id: msg.message_id,\n    reply_markup: {\n        inline_keyboard: [[]]\n    },\n}\n\nif (msg.message > 1) {\n    msg.payload.reply_markup.inline_keyboard[0].push({\n                text: \"â—€ ÐœÐ¸Ð½ÑƒÐ»Ðµ\",\n                callback_data: \"theMostPopularQPagination_\" + (msg.message - 1)\n            });\n}\n\nif (msg.message < 5) {\n    msg.payload.reply_markup.inline_keyboard[0].push({\n                text: \"ÐÐ°ÑÑ‚ÑƒÐ¿Ð½Ðµ â–¶\",\n                callback_data: \"theMostPopularQPagination_\" + (msg.message + 1)\n            });\n}\n\nif (msg.sendAsASimpleMessage) return [msg, null];\nelse return [null, msg];",
        "outputs": 2,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 1150,
        "y": 180,
        "wires": [
            [
                "d5c114ce.369d48"
            ],
            [
                "9fc24cee.822f5"
            ]
        ]
    },
    {
        "id": "5b820640.b7dcf8",
        "type": "comment",
        "z": "d3d080fa.62628",
        "name": "Setting up answer to next or last or first question(pagination)",
        "info": "",
        "x": 420,
        "y": 140,
        "wires": []
    },
    {
        "id": "9fc24cee.822f5",
        "type": "change",
        "z": "d3d080fa.62628",
        "name": "Setting up editMessageText url",
        "rules": [
            {
                "t": "set",
                "p": "url",
                "pt": "msg",
                "to": "\"https://api.telegram.org/bot\" & $env('TOKEN') & \"/editMessageText\"",
                "tot": "jsonata"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1490,
        "y": 300,
        "wires": [
            [
                "43f8240a.a3c04c"
            ]
        ]
    },
    {
        "id": "43f8240a.a3c04c",
        "type": "http request",
        "z": "d3d080fa.62628",
        "name": "",
        "method": "POST",
        "ret": "obj",
        "paytoqs": "ignore",
        "url": "",
        "tls": "",
        "persist": false,
        "proxy": "",
        "authType": "basic",
        "x": 1770,
        "y": 300,
        "wires": [
            []
        ]
    },
    {
        "id": "db785c0e.a93d6",
        "type": "link in",
        "z": "d3d080fa.62628",
        "name": "Set answer to question(pagination)",
        "links": [
            "44ca7e7d.f7226",
            "d7b8d232.f7981"
        ],
        "x": 215,
        "y": 180,
        "wires": [
            [
                "393aa544.3be7ba"
            ]
        ]
    },
    {
        "id": "393aa544.3be7ba",
        "type": "function",
        "z": "d3d080fa.62628",
        "name": "Getting info from questions",
        "func": "msg.sendAsASimpleMessage = false;\n\nif (msg.message.startsWith(\"theMostPopularQPagination_\")) {\n    msg.message = parseInt(msg.message.split(\"_\")[1]);\n} else {\n    msg.message = 1;\n    \n    msg.sendAsASimpleMessage = true;\n}\n\nmsg.topic = \"SELECT * FROM questions ORDER BY calls DESC LIMIT \" + msg.message + \";\"\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 440,
        "y": 180,
        "wires": [
            [
                "27d280f8.1ec68"
            ]
        ]
    },
    {
        "id": "255971.a036369",
        "type": "link in",
        "z": "276bc02d.e347",
        "name": "Send message with page info",
        "links": [
            "84602d83.794bf"
        ],
        "x": 75,
        "y": 100,
        "wires": [
            [
                "7d62bb88.a5bb24"
            ]
        ]
    },
    {
        "id": "dd7e88ad.066828",
        "type": "function",
        "z": "276bc02d.e347",
        "name": "Setting up message info",
        "func": "msg.payload = {\n    parse_mode: \"html\",\n    text: msg.payload[0].content,\n    chat_id: msg.chat_id,\n    reply_markup: {\n        inline_keyboard: [[\n            {\n                text: \"â—€ Ð“Ð¾Ð»Ð¾Ð²Ð½Ðµ Ð¼ÐµÐ½ÑŽ\",\n                callback_data: \"mainMenu\"\n            }]\n        ]\n    },\n}\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 910,
        "y": 100,
        "wires": [
            [
                "a38f117b.4a1c1"
            ]
        ]
    },
    {
        "id": "640de173.48ae8",
        "type": "comment",
        "z": "276bc02d.e347",
        "name": "Message with page Info",
        "info": "",
        "x": 160,
        "y": 60,
        "wires": []
    },
    {
        "id": "7d62bb88.a5bb24",
        "type": "function",
        "z": "276bc02d.e347",
        "name": "Getting info from InfoPages",
        "func": "msg.topic = \"SELECT content FROM InfoPages WHERE title = '\" + msg.payload.callback_query.data + \"';\";\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 300,
        "y": 100,
        "wires": [
            [
                "a61ac57f.450b88"
            ]
        ]
    },
    {
        "id": "a61ac57f.450b88",
        "type": "mysql",
        "z": "276bc02d.e347",
        "mydb": "529c4263.aeab0c",
        "name": "",
        "x": 590,
        "y": 100,
        "wires": [
            [
                "dd7e88ad.066828",
                "b8e30ec7.7d583"
            ]
        ]
    },
    {
        "id": "b8e30ec7.7d583",
        "type": "debug",
        "z": "276bc02d.e347",
        "name": "Getting info from InfoPage response from db",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 900,
        "y": 200,
        "wires": []
    },
    {
        "id": "a38f117b.4a1c1",
        "type": "subflow:411ddac8.164cb4",
        "z": "276bc02d.e347",
        "name": "",
        "env": [],
        "x": 1230,
        "y": 100,
        "wires": [
            []
        ]
    },
    {
        "id": "336efa19.615be6",
        "type": "subflow:4001764a.8341f8",
        "z": "dbbd86af.74c0d8",
        "name": "",
        "env": [],
        "x": 870,
        "y": 1280,
        "wires": [
            [
                "c255e784.8ab028"
            ]
        ]
    },
    {
        "id": "c017e434.7d5098",
        "type": "subflow:4001764a.8341f8",
        "z": "dbbd86af.74c0d8",
        "name": "",
        "env": [],
        "x": 870,
        "y": 500,
        "wires": [
            [
                "d4173cf4.07cab",
                "db142eec.63a9b",
                "59c1267b.ca3c98"
            ]
        ]
    },
    {
        "id": "d5c114ce.369d48",
        "type": "subflow:411ddac8.164cb4",
        "z": "d3d080fa.62628",
        "name": "",
        "env": [],
        "x": 1490,
        "y": 80,
        "wires": [
            []
        ]
    }
]